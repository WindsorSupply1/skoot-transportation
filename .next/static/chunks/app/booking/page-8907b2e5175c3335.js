(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{4654:function(){},3925:function(e,s,t){Promise.resolve().then(t.bind(t,7771))},7771:function(e,s,t){"use strict";let a;t.r(s),t.d(s,{default:function(){return et}});var r=t(7437),l=t(2265),n=t(9376),i=t(3774),o=t(5805),c=t(8226),d=t(401),m=t(2660),x=t(3041),u=t(2252),h=t(1047),g=t(1723);function p(e){let{onComplete:s}=e,[t,a]=(0,l.useState)([]),[n,c]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[x,p]=(0,l.useState)(""),[f,j]=(0,l.useState)(null),[b,y]=(0,l.useState)(null),[N,v]=(0,l.useState)(1),[w,k]=(0,l.useState)("ADULT");(0,l.useEffect)(()=>{S()},[]);let S=async()=>{try{m(!0);let e=await fetch("/api/routes"),s=await e.json();a(s.routes||[]);let t=await fetch("/api/schedules"),r=await t.json();c(r.schedules||[])}catch(e){console.error("Error fetching data:",e)}finally{m(!1)}},C=e=>new Date(e).getDay(),D=e=>x?e.upcomingDepartures.filter(e=>{let s=new Date(e.date),t=new Date(x);return s.toDateString()===t.toDateString()}):[],A=e=>{let[s,t]=e.split(":"),a=parseInt(s);return"".concat(0===a?12:a>12?a-12:a,":").concat(t," ").concat(a>=12?"PM":"AM")},P=(e,s)=>{let t=e/s;return t>.5?"text-green-600":t>.2?"text-yellow-600":"text-red-600"},I=()=>x&&f&&b&&N>0;if(d)return(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})});let Z=(()=>{if(!x)return[];let e=C(x);return n.filter(s=>s.dayOfWeek===e)})();return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Select Your Trip Details"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Choose your departure date, time, and number of passengers."})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(h.Z,{className:"w-5 h-5 text-blue-500"}),(0,r.jsx)("label",{className:"text-lg font-medium text-gray-700",children:"Travel Date"})]}),(0,r.jsx)("input",{type:"date",value:x,onChange:e=>{p(e.target.value),j(null),y(null)},min:new Date().toISOString().split("T")[0],className:"w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"})]}),x&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(g.Z,{className:"w-5 h-5 text-blue-500"}),(0,r.jsx)("label",{className:"text-lg font-medium text-gray-700",children:"Available Departures"})]}),0===Z.length?(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-yellow-600"}),(0,r.jsx)("p",{className:"text-yellow-800",children:"No departures available for the selected date."})]}),(0,r.jsx)("p",{className:"text-yellow-700 text-sm mt-1",children:"Please try a different date or check our schedule."})]}):(0,r.jsx)("div",{className:"grid gap-4",children:Z.map(e=>{let s=D(e);return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.route.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.route.origin," → ",e.route.destination]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"font-medium",children:A(e.time)}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[e.route.duration," min trip"]})]})]}),0===s.length?(0,r.jsx)("div",{className:"bg-gray-50 rounded p-3",children:(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"No departures available for this date"})}):(0,r.jsx)("div",{className:"space-y-2",children:s.map(s=>(0,r.jsx)("button",{onClick:()=>{j(e),y(s)},className:"w-full p-3 rounded-lg border-2 transition-all ".concat((null==b?void 0:b.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"font-medium",children:new Date(s.date).toLocaleDateString()}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[A(e.time)," departure"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"font-medium ".concat(P(s.availableSeats,s.capacity)),children:[s.availableSeats," seats available"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["of ",s.capacity," total"]})]})]})},s.id))})]},e.id)})})]}),b&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(o.Z,{className:"w-5 h-5 text-blue-500"}),(0,r.jsx)("label",{className:"text-lg font-medium text-gray-700",children:"Number of Passengers"})]}),(0,r.jsx)("select",{value:N,onChange:e=>v(parseInt(e.target.value)),className:"w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors",children:Array.from({length:Math.min(b.availableSeats,8)},(e,s)=>s+1).map(e=>(0,r.jsxs)("option",{value:e,children:[e," ",1===e?"Passenger":"Passengers"]},e))})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(i.Z,{className:"w-5 h-5 text-blue-500"}),(0,r.jsx)("label",{className:"text-lg font-medium text-gray-700",children:"Ticket Type"})]}),(0,r.jsxs)("select",{value:w,onChange:e=>k(e.target.value),className:"w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors",children:[(0,r.jsx)("option",{value:"ADULT",children:"Adult - Standard Rate"}),(0,r.jsx)("option",{value:"CHILD",children:"Child (2-12) - Discounted"}),(0,r.jsx)("option",{value:"SENIOR",children:"Senior (65+) - Discounted"})]})]})]}),f&&b&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-blue-900 mb-4",children:"Trip Summary"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Route:"}),(0,r.jsx)("span",{className:"font-medium",children:f.route.name})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Date:"}),(0,r.jsx)("span",{className:"font-medium",children:new Date(x).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Departure:"}),(0,r.jsx)("span",{className:"font-medium",children:A(f.time)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Passengers:"}),(0,r.jsxs)("span",{className:"font-medium",children:[N," \xd7 ",w.toLowerCase()]})]})]})]}),(0,r.jsx)("div",{className:"flex justify-end pt-6",children:(0,r.jsx)("button",{onClick:()=>{I()&&f&&b&&s({routeId:f.route.id,scheduleId:f.id,departureId:b.id,date:x,passengers:N,ticketType:w})},disabled:!I(),className:"px-8 py-3 rounded-lg font-semibold transition-all ".concat(I()?"bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Continue to Customer Details"})})]})}var f=t(8941),j=t(605),b=t(2489),y=t(9345),N=t(6337),v=t(7769),w=t(2208);function k(e){let{isOpen:s,onClose:t,redirectTo:a}=e,[i,o]=(0,l.useState)({email:"",password:""}),[c,d]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!1),[u,h]=(0,l.useState)(""),[g,p]=(0,l.useState)(null),f=(0,n.useRouter)(),k=e=>{o({...i,[e.target.name]:e.target.value}),u&&h("")},S=async e=>{e.preventDefault(),x(!0),h("");try{let e=await (0,j.signIn)("credentials",{email:i.email.toLowerCase(),password:i.password,redirect:!1});if(null==e?void 0:e.error)h("Invalid email or password");else if(null==e?void 0:e.ok){var s;let e=await (0,j.getSession)();t(),a?f.push(a):(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.isAdmin)?f.push("/admin"):f.push("/")}}catch(e){console.error("Sign in error:",e),h("An unexpected error occurred. Please try again.")}finally{x(!1)}},C=async e=>{p(e),h("");try{let s=await (0,j.signIn)(e,{redirect:!1,callbackUrl:a||"/"});(null==s?void 0:s.error)?h("Error signing in with ".concat(e,". Please try again.")):(null==s?void 0:s.ok)&&(t(),s.url&&f.push(s.url))}catch(s){console.error("".concat(e," sign in error:"),s),h("Error signing in with ".concat(e,". Please try again."))}finally{p(null)}};return s?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Sign in to SKOOT"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Access your bookings and save preferences"})]}),(0,r.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(b.Z,{className:"h-6 w-6"})})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>C("google"),disabled:!!g,className:"w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:["google"===g?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-600"}):(0,r.jsxs)("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"google"===g?"Signing in...":"Continue with Google"]}),(0,r.jsxs)("button",{onClick:()=>C("amazon"),disabled:!!g,className:"w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:["amazon"===g?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-600"}):(0,r.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"#FF9900",children:(0,r.jsx)("path",{d:"M.045 18.02c.072-.116.187-.173.34-.173.116 0 .208.042.275.127.067.085.101.2.101.344 0 .135-.034.247-.101.336-.067.089-.159.133-.275.133-.153 0-.268-.057-.34-.173-.072-.116-.108-.243-.108-.38 0-.137.036-.264.108-.214zm23.042.827c-.067.187-.17.347-.307.48-.137.133-.297.229-.48.288-.183.059-.38.089-.593.089-.324 0-.608-.073-.853-.22-.245-.147-.437-.347-.576-.6l1.312-.576c.061.147.153.263.275.348.122.085.263.127.424.127.116 0 .213-.025.291-.076.078-.051.139-.118.183-.2.044-.082.066-.171.066-.266v-.115c-.122.094-.263.169-.424.224-.161.055-.336.082-.527.082-.25 0-.471-.04-.662-.121-.191-.081-.344-.193-.457-.336-.113-.143-.169-.306-.169-.49 0-.203.064-.379.193-.527.129-.148.306-.264.531-.348.225-.084.479-.126.762-.126.3 0 .555.043.762.13.207.087.371.211.49.371.119.16.178.348.178.563v1.447c0 .171.014.31.042.416.028.106.075.186.141.24v.032zm-1.093-1.814c-.067-.116-.159-.205-.275-.266-.116-.061-.249-.092-.398-.092-.183 0-.336.048-.457.144-.121.096-.182.219-.182.367 0 .135.055.242.166.322.111.08.254.12.429.12.122 0 .234-.017.336-.05.102-.033.19-.08.263-.141.073-.061.127-.135.158-.22v-.184zm-3.111-.092c0-.25-.067-.449-.2-.596-.133-.147-.317-.22-.551-.22-.234 0-.418.073-.551.22-.133.147-.2.346-.2.596 0 .25.067.449.2.596.133.147.317.22.551.22.234 0 .418-.073.551-.22.133-.147.2-.346.2-.596zm1.312 0c0 .414-.1.771-.301 1.071-.201.3-.473.535-.817.704-.344.169-.731.253-1.161.253-.43 0-.817-.084-1.161-.253-.344-.169-.616-.404-.817-.704-.201-.3-.301-.657-.301-1.071 0-.414.1-.771.301-1.071.201-.3.473-.535.817-.704.344-.169.731-.253 1.161-.253.43 0 .817.084 1.161.253.344.169.616.404.817.704.201.3.301.657.301 1.071z"})}),"amazon"===g?"Signing in...":"Continue with Amazon"]})]}),(0,r.jsxs)("div",{className:"relative my-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),(0,r.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[u&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,r.jsx)("div",{className:"text-red-800 text-sm",children:u})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",value:i.email,onChange:k,required:!0,className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"Enter your email"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(N.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"password",name:"password",type:c?"text":"password",value:i.password,onChange:k,required:!0,className:"w-full pl-9 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"Enter your password"}),(0,r.jsx)("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:c?(0,r.jsx)(v.Z,{className:"h-4 w-4"}):(0,r.jsx)(w.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)("button",{type:"submit",disabled:m||!!g,className:"w-full bg-orange-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):"Sign In"})]}),(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,r.jsx)("button",{onClick:()=>{t(),a&&f.push(a)},className:"w-full text-gray-600 hover:text-gray-900 text-sm font-medium transition-colors",children:"Continue as Guest"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 text-center mt-1",children:"You can create an account later to save your booking details"})]}),(0,r.jsxs)("div",{className:"mt-4 text-center text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Don't have an account? "}),(0,r.jsx)("button",{onClick:()=>{t(),f.push("/auth/signup")},className:"text-orange-600 hover:text-orange-700 font-medium",children:"Sign up"})]})]})]})}):null}var S=t(9501),C=t(3590),D=t(7119),A=t(2369);let P=D.Ry({firstName:D.Z_().min(2,"First name must be at least 2 characters"),lastName:D.Z_().min(2,"Last name must be at least 2 characters"),email:D.Z_().email("Valid email is required"),phone:D.Z_().min(10,"Phone number is required"),createAccount:D.O7().optional()});function I(e){let{onSubmit:s,onSignInInstead:t,isLoading:a=!1}=e,[n,i]=(0,l.useState)(!1),{register:o,handleSubmit:c,formState:{errors:d},watch:m}=(0,S.cI)({resolver:(0,C.F)(P),defaultValues:{createAccount:!1}});return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Continue as Guest"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Fill in your information to complete your booking. No account required."})]}),(0,r.jsxs)("form",{onSubmit:c(e=>{s({...e,createAccount:n})}),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(A.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"firstName",...o("firstName"),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"Enter your first name"})]}),d.firstName&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:d.firstName.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(A.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"lastName",...o("lastName"),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"Enter your last name"})]}),d.lastName&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:d.lastName.message})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"email",type:"email",...o("email"),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"Enter your email address"})]}),d.email&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:d.email.message}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"We'll send your booking confirmation to this email"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{id:"phone",type:"tel",...o("phone"),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",placeholder:"(555) 123-4567"})]}),d.phone&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:d.phone.message})]}),(0,r.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex items-center h-5",children:(0,r.jsx)("input",{id:"createAccount",type:"checkbox",checked:n,onChange:e=>i(e.target.checked),className:"h-4 w-4 text-orange-600 border-orange-300 rounded focus:ring-orange-500"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("label",{htmlFor:"createAccount",className:"text-sm font-medium text-orange-900",children:"Create an account for faster future bookings"}),(0,r.jsx)("p",{className:"text-xs text-orange-700 mt-1",children:"Save your preferences, view booking history, and get faster checkout next time. You can set up your password after completing this booking."})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",disabled:a,className:"flex-1 bg-orange-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):"Continue to Payment"}),(0,r.jsx)("button",{type:"button",onClick:t,className:"flex-1 bg-white text-gray-700 py-3 px-4 rounded-lg font-medium border border-gray-300 hover:bg-gray-50 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors",children:"Sign In Instead"})]})]}),!n&&(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Benefits of creating an account:"}),(0,r.jsxs)("ul",{className:"text-xs text-gray-600 space-y-1",children:[(0,r.jsx)("li",{children:"• View and manage all your bookings in one place"}),(0,r.jsx)("li",{children:"• Faster checkout for future trips"}),(0,r.jsx)("li",{children:"• Receive booking reminders and updates"}),(0,r.jsx)("li",{children:"• Save your preferred pickup locations"})]})]})]})}function Z(e){let{tripDetails:s,onComplete:t}=e,{isAuthenticated:a,user:n,isLoading:i}=(0,f.a)(),[o,d]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[u,h]=(0,l.useState)(!1),g=e=>{var s,a;t({...e,firstName:(null==n?void 0:null===(s=n.name)||void 0===s?void 0:s.split(" ")[0])||e.firstName,lastName:(null==n?void 0:null===(a=n.name)||void 0===a?void 0:a.split(" ").slice(1).join(" "))||e.lastName,email:(null==n?void 0:n.email)||e.email})};return i?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Information"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Complete your booking with your contact details"})]}),(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-orange-900 mb-2",children:"Trip Summary"}),(0,r.jsxs)("div",{className:"text-sm text-orange-700 space-y-1",children:[(0,r.jsxs)("div",{children:["Date: ",new Date(s.date).toLocaleDateString()]}),(0,r.jsxs)("div",{children:["Passengers: ",s.passengers]}),(0,r.jsxs)("div",{children:["Ticket Type: ",s.ticketType]})]})]}),a&&n?(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(A.Z,{className:"w-5 h-5 text-green-600"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-green-900",children:["Welcome back, ",n.name,"!"]}),(0,r.jsx)("p",{className:"text-sm text-green-700",children:"We'll use your saved information for faster checkout"})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg p-4 mb-4",children:(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-gray-600",children:"Name:"}),(0,r.jsx)("div",{className:"font-medium",children:n.name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-gray-600",children:"Email:"}),(0,r.jsx)("div",{className:"font-medium",children:n.email})]})]})}),(0,r.jsxs)("button",{onClick:()=>{var e,s;return g({firstName:(null===(e=n.name)||void 0===e?void 0:e.split(" ")[0])||"",lastName:(null===(s=n.name)||void 0===s?void 0:s.split(" ").slice(1).join(" "))||"",email:n.email||"",phone:"",pickupLocationId:""})},className:"w-full bg-orange-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors flex items-center justify-center",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Continue to Payment"]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[!m&&(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Choose how to continue"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("button",{onClick:()=>x("signin"),className:"border-2 border-orange-200 rounded-lg p-4 hover:border-orange-300 hover:bg-orange-50 transition-colors text-left",children:[(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)(A.Z,{className:"w-5 h-5 text-orange-600 mr-2"}),(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:"Sign In"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Access your account for faster checkout and booking history"}),(0,r.jsxs)("ul",{className:"text-xs text-gray-500 mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• Saved payment methods"}),(0,r.jsx)("li",{children:"• Booking history"}),(0,r.jsx)("li",{children:"• Faster future bookings"})]})]}),(0,r.jsxs)("button",{onClick:()=>x("guest"),className:"border-2 border-gray-200 rounded-lg p-4 hover:border-gray-300 hover:bg-gray-50 transition-colors text-left",children:[(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 text-gray-600 mr-2"}),(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:"Continue as Guest"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Book quickly without creating an account"}),(0,r.jsxs)("ul",{className:"text-xs text-gray-500 mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• No account required"}),(0,r.jsx)("li",{children:"• Quick checkout"}),(0,r.jsx)("li",{children:"• Optional account creation later"})]})]})]})]}),"signin"===m&&(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sign in to your account"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Access your saved information and booking history"}),(0,r.jsx)("button",{onClick:()=>d(!0),className:"bg-orange-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors",children:"Sign In"}),(0,r.jsx)("button",{onClick:()=>x(null),className:"ml-4 text-gray-600 hover:text-gray-800 transition-colors",children:"Back"})]})}),"guest"===m&&(0,r.jsxs)("div",{children:[(0,r.jsx)(I,{onSubmit:e=>{h(!0);let s={firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone,pickupLocationId:"",createAccount:e.createAccount};setTimeout(()=>{t(s),h(!1)},500)},onSignInInstead:()=>{d(!0)},isLoading:u}),(0,r.jsx)("button",{onClick:()=>x(null),className:"mt-4 text-center w-full text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to options"})]})]}),(0,r.jsx)(k,{isOpen:o,onClose:()=>d(!1),redirectTo:"/booking"})]})}var T=t(6853),E=t(2360),R=t(5573),L=t(257);let B=()=>(a||(a=(0,E.J)(L.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY)),a);function O(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"usd";return new Intl.NumberFormat(["en-US"],{style:"currency",currency:s,currencyDisplay:"symbol"}).format(e/100)}new R.Z(L.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16",typescript:!0}),D.Ry({bookingId:D.Z_().min(1,"Booking ID is required"),amount:D.Rx().positive("Amount must be positive"),currency:D.Z_().length(3).default("usd")}),D.Ry({routeId:D.Z_().min(1,"Route ID is required"),passengerCount:D.Rx().int().min(1,"At least 1 passenger required").max(15,"Maximum 15 passengers allowed"),customerType:D.Km(["REGULAR","STUDENT","MILITARY","LEGACY"]).default("REGULAR"),ticketType:D.Km(["ADULT","CHILD","SENIOR"]).default("ADULT"),isRoundTrip:D.O7().default(!1),extraLuggageBags:D.Rx().int().min(0).max(10).default(0),petCount:D.Rx().int().min(0).max(3).default(0),promoCode:D.Z_().optional()}),D.Ry({bookingId:D.Z_().min(1,"Booking ID is required"),reason:D.Z_().optional(),amount:D.Rx().positive().optional(),notifyCustomer:D.O7().default(!0)});class _{static validatePaymentAmount(e,s){return Math.round(100*e)===Math.round(100*s)}static validateCreditCard(e){let s=e.replace(/\D/g,"");if(s.length<13||s.length>19)return!1;let t=0,a=!1;for(let e=s.length-1;e>=0;e--){let r=parseInt(s[e]);a&&(r*=2)>9&&(r-=9),t+=r,a=!a}return t%10==0}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validatePhoneNumber(e){return/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(e)}static validateBookingDate(e){return e>new Date(new Date().getTime()+18e5)}static validateCapacity(e,s){return e<=s&&e>0}static validatePromoCode(e){return!!e&&/^[A-Z0-9]{3,15}$/.test(e.toUpperCase())}}class F{static isRateLimited(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:9e5,a=Date.now(),r=this.attempts.get(e);return!r||a>r.resetTime?(this.attempts.set(e,{count:1,resetTime:a+t}),!1):r.count>=s||(r.count++,!1)}static getRemainingTime(e){let s=this.attempts.get(e);return s?Math.max(0,s.resetTime-Date.now()):0}static reset(e){this.attempts.delete(e)}}F.attempts=new Map;class M{static sanitizeInput(e){return e.trim().replace(/[<>]/g,"").substring(0,1e3)}static generateBookingReference(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s="";for(let t=0;t<8;t++)s+=e.charAt(Math.floor(Math.random()*e.length));return"SKT".concat(s)}static hashForLogging(e){return e.length<4?"***":e.substring(0,2)+"*".repeat(e.length-4)+e.slice(-2)}static validateWebhookTimestamp(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return Math.abs(Math.floor(Date.now()/1e3)-e)<=s}}var U=t(5302),z=t(4286),Y=t(5863),q=t(5252);let H={style:{base:{color:"#424770",fontFamily:"Inter, system-ui, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146",iconColor:"#9e2146"}},hidePostalCode:!0};function G(e){let{tripDetails:s,customerDetails:t,onComplete:a,bookingData:n}=e,i=(0,T.useStripe)(),o=(0,T.useElements)(),[d,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),[g,p]=(0,l.useState)(!1),[f,j]=(0,l.useState)(null),[b,y]=(0,l.useState)(null),[v,w]=(0,l.useState)({}),[k,S]=(0,l.useState)({cardNumber:!1,expiry:!1,cvc:!1}),C=Object.values(k).every(Boolean)&&0===Object.keys(v).length;(0,l.useEffect)(()=>{(null==n?void 0:n.id)&&D()},[null==n?void 0:n.id]);let D=async()=>{try{let e=await fetch("/api/stripe/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:n.id,amount:n.totalAmount,currency:"usd"})}),s=await e.json();e.ok?(j(s.clientSecret),y(s.paymentIntentId)):h(s.error||"Failed to create payment intent")}catch(e){h("Failed to initialize payment. Please try again.")}},A=(0,l.useCallback)(e=>s=>{w(t=>{let a={...t};return s.error?a[e]=s.error.message:delete a[e],a}),S(t=>({...t,[e]:s.complete}))},[]),P=async e=>{if(e.preventDefault(),!i||!o||!f)return;let s="payment_".concat(t.email);if(F.isRateLimited(s,3,3e5)){let e=Math.ceil(F.getRemainingTime(s)/1e3/60);h("Too many payment attempts. Please try again in ".concat(e," minutes."));return}m(!0),h(null);let r=o.getElement(T.CardNumberElement);if(!r){h("Card information is incomplete"),m(!1);return}if(!_.validateEmail(t.email)){h("Please provide a valid email address"),m(!1);return}try{let{error:e,paymentIntent:l}=await i.confirmCardPayment(f,{payment_method:{card:r,billing_details:{name:M.sanitizeInput("".concat(t.firstName," ").concat(t.lastName)),email:t.email,phone:t.phone}}});if(e){let s=e instanceof R.Z.errors.StripeError?{message:e.message,code:e.code}:"card_declined"===e.code?{message:"Your card was declined. Please try a different payment method.",code:e.code}:"expired_card"===e.code?{message:"Your card has expired. Please use a different payment method.",code:e.code}:"insufficient_funds"===e.code?{message:"Your card has insufficient funds. Please use a different payment method.",code:e.code}:"processing_error"===e.code?{message:"An error occurred while processing your payment. Please try again.",code:e.code}:{message:"An unexpected error occurred. Please try again.",code:"unknown_error"};h(s.message),m(!1);return}l&&"succeeded"===l.status?(F.reset(s),p(!0),a({stripePaymentMethodId:l.payment_method,paymentIntentId:n.id})):(l&&"requires_action"===l.status?h("Authentication required. Please follow the prompts from your bank."):h("Payment was not successful. Please try again."),m(!1))}catch(e){console.error("Payment error:",e),e instanceof Error?e.message.includes("network")?h("Network error. Please check your connection and try again."):e.message.includes("timeout")?h("Payment timed out. Please try again."):h("An unexpected error occurred. Please try again."):h("An unexpected error occurred. Please try again."),m(!1)}};return g?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(U.Z,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Payment Successful!"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Processing your booking confirmation..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Secure Payment"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Complete your booking with our secure payment system"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Booking Summary"}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Passengers:"}),(0,r.jsx)("span",{className:"font-medium",children:(null==n?void 0:n.passengerCount)||s.passengers})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Route:"}),(0,r.jsx)("span",{className:"font-medium",children:(null==n?void 0:n.route)||"Route info"})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,r.jsx)("span",{className:"font-medium",children:new Date(s.date).toLocaleDateString()})]}),(0,r.jsx)("hr",{className:"border-gray-300"}),(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsx)("span",{className:"text-blue-600",children:(null==n?void 0:n.totalAmount)?O(100*n.totalAmount):"$--.--.--"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[(0,r.jsx)(z.Z,{className:"w-4 h-4 text-green-500"}),(0,r.jsx)("span",{children:"Secured by Stripe • PCI DSS Compliant"}),(0,r.jsx)(N.Z,{className:"w-4 h-4 text-green-500"})]}),(0,r.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 inline mr-2"}),"Card Number"]}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg p-3 bg-white",children:(0,r.jsx)(T.CardNumberElement,{options:H,onChange:A("cardNumber")})}),v.cardNumber&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),v.cardNumber]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date"}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg p-3 bg-white",children:(0,r.jsx)(T.CardExpiryElement,{options:H,onChange:A("expiry")})}),v.expiry&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),v.expiry]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CVC"}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg p-3 bg-white",children:(0,r.jsx)(T.CardCvcElement,{options:H,onChange:A("cvc")})}),v.cvc&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),v.cvc]})]})]}),x&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-red-400 mr-2"}),(0,r.jsx)("p",{className:"text-red-800",children:x})]})}),(0,r.jsx)("button",{type:"submit",disabled:!i||!C||d||!f,className:"w-full py-3 px-4 rounded-lg font-medium transition-colors ".concat(i&&C&&!d&&f?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:d?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)(Y.Z,{className:"w-5 h-5 animate-spin mr-2"}),"Processing Payment..."]}):(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)(q.Z,{className:"w-5 h-5 mr-2"}),"Pay ",(null==n?void 0:n.totalAmount)?O(100*n.totalAmount):"Amount"]})}),(0,r.jsx)("p",{className:"text-xs text-center text-gray-500",children:"By completing your purchase, you agree to our terms of service and privacy policy."})]})]})}function K(e){let[s]=(0,l.useState)(()=>B()),[t,a]=(0,l.useState)(null),[n,i]=(0,l.useState)(!0),[o,c]=(0,l.useState)(null);(0,l.useEffect)(()=>{d()},[]);let d=async()=>{try{var s,t,r;i(!0);let l=Number(null===(s=e.tripDetails)||void 0===s?void 0:s.passengers)||1,n=String((null===(t=e.tripDetails)||void 0===t?void 0:t.departureId)||""),o=String((null===(r=e.customerDetails)||void 0===r?void 0:r.pickupLocationId)||""),c={departureId:n,pickupLocationId:o,passengerCount:l,customerType:{ADULT:"REGULAR",CHILD:"REGULAR",SENIOR:"REGULAR"}[e.tripDetails.ticketType],guestInfo:{firstName:String(e.customerDetails.firstName||"").trim(),lastName:String(e.customerDetails.lastName||"").trim(),email:String(e.customerDetails.email||"").toLowerCase().trim(),phone:(()=>{let s=String(e.customerDetails.phone||"").replace(/\D/g,"");return s.length>=10?s:"0000000000"})(),createAccount:!1},passengers:Array.from({length:l},(s,t)=>({firstName:String(e.customerDetails.firstName||"").trim(),lastName:String(e.customerDetails.lastName||"").trim(),age:"CHILD"===e.tripDetails.ticketType?8:"SENIOR"===e.tripDetails.ticketType?70:30})),extraLuggage:0,pets:0};console.log("PaymentStep - Sending booking data:",JSON.stringify(c,null,2));let d=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),m=await d.json();if(d.ok&&m.booking)console.log("PaymentStep - Booking created successfully:",m.booking.id),a(m.booking);else{console.error("Booking API error:",m),console.error("Full API response:",{status:d.status,statusText:d.statusText,result:m});let e="Failed to create booking";if(m.details&&Array.isArray(m.details)){let s=m.details.map(e=>{var s;return"".concat(null===(s=e.path)||void 0===s?void 0:s.join("."),": ").concat(e.message)}).join(", ");e="Validation errors: ".concat(s)}else m.error&&(e=m.error);throw a(null),Error(e)}}catch(e){console.error("Booking creation error:",e),a(null),c(e instanceof Error?e.message:"Failed to create booking")}finally{i(!1)}};return n?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(Y.Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-500"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Preparing your booking..."})]}):o||!t?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(u.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Booking Creation Failed"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:o||"There was an error creating your booking. Please try again."}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700 transition-colors",children:"Try Again"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"If the problem persists, please contact support at hello@skoot.bike"})]})]}):(0,r.jsx)(T.Elements,{stripe:s,children:(0,r.jsx)(G,{...e,bookingData:t})})}var V=t(1621),W=t(8501),$=t(2735),J=t(9637),Q=t(7648);function X(e){var s,t,a;let{bookingId:n,tripDetails:d,customerDetails:m,onNewBooking:u}=e,{user:p}=(0,f.a)(),[j,b]=(0,l.useState)(null),[N,v]=(0,l.useState)(!0),[w,k]=(0,l.useState)(null);(0,l.useEffect)(()=>{S()},[n]);let S=async()=>{try{let e=await fetch("/api/bookings/".concat(n));if(e.ok){let s=await e.json();b(s.booking)}else throw Error("Failed to fetch booking details")}catch(e){k("Unable to load booking details")}finally{v(!1)}};return N?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading booking details..."})]}):w?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-red-500 rounded-full"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error Loading Details"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:w}),(0,r.jsx)("button",{onClick:u,className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:"Start New Booking"})]}):(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6",children:(0,r.jsx)(U.Z,{className:"h-12 w-12 text-green-600"})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-green-800 mb-2",children:"Booking Confirmed!"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg",children:"Your shuttle reservation is confirmed and ready"}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg inline-block",children:(0,r.jsxs)("p",{className:"text-sm text-green-800",children:[(0,r.jsx)("strong",{children:"Booking ID:"})," ",n]})})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,r.jsx)(V.Z,{className:"w-5 h-5 mr-2 text-orange-600"}),"Trip Details"]}),(0,r.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5 text-orange-600 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Travel Date"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:d&&new Date(d.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(g.Z,{className:"h-5 w-5 text-orange-600 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Departure Time"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:(null==j?void 0:null===(s=j.schedule)||void 0===s?void 0:s.time)&&(e=>{let[s,t]=e.split(":"),a=parseInt(s);return"".concat(0===a?12:a>12?a-12:a,":").concat(t," ").concat(a>=12?"PM":"AM")})(j.schedule.time)})]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-5 w-5 text-orange-600 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Passengers"}),(0,r.jsxs)("div",{className:"font-medium text-gray-900",children:[null==d?void 0:d.passengers," \xd7 ",null==d?void 0:d.ticketType.toLowerCase()]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(i.Z,{className:"h-5 w-5 text-green-600 mr-3 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Pickup Location"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:(null==j?void 0:null===(t=j.pickupLocation)||void 0===t?void 0:t.name)||"Columbia, SC"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:null==j?void 0:null===(a=j.pickupLocation)||void 0===a?void 0:a.address})]})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(i.Z,{className:"h-5 w-5 text-blue-600 mr-3 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Destination"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:"Charlotte Douglas Airport"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"All terminals"})]})]}),(0,r.jsxs)("div",{className:"pt-4 border-t",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total Paid:"}),(0,r.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",((null==j?void 0:j.totalAmount)/100).toFixed(2)||"--"]})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Payment confirmed via Stripe"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contact Information"}),(0,r.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3",children:(0,r.jsx)("span",{className:"text-orange-600 font-semibold text-sm",children:null==m?void 0:m.firstName.charAt(0)})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Customer"}),(0,r.jsxs)("div",{className:"font-medium",children:[null==m?void 0:m.firstName," ",null==m?void 0:m.lastName]})]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(y.Z,{className:"h-4 w-4 text-gray-400 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Email"}),(0,r.jsx)("div",{className:"font-medium text-sm",children:null==m?void 0:m.email})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,r.jsxs)("h3",{className:"font-semibold text-blue-900 mb-4 flex items-center",children:[(0,r.jsx)(g.Z,{className:"w-5 h-5 mr-2"}),"What Happens Next?"]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5",children:"1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-900",children:"Confirmation Email"}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"Check your email for detailed pickup instructions and driver contact info"})]})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5",children:"2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-900",children:"Driver Contact"}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"Your driver will call/text 30 minutes before pickup with final details"})]})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5",children:"3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-900",children:"Be Ready"}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"Arrive at pickup location 5 minutes early with your luggage ready"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-orange-900 mb-3",children:"Important Reminders"}),(0,r.jsxs)("ul",{className:"text-sm text-orange-800 space-y-2",children:[(0,r.jsxs)("li",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-orange-600 mr-2",children:"•"}),(0,r.jsxs)("span",{children:["Arrive at the airport ",(0,r.jsx)("strong",{children:"2+ hours before your flight"})," (travel time is 100-130 minutes)"]})]}),(0,r.jsxs)("li",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-orange-600 mr-2",children:"•"}),(0,r.jsx)("span",{children:"We include a 10-minute stop in Rock Hill during the journey"})]}),(0,r.jsxs)("li",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-orange-600 mr-2",children:"•"}),(0,r.jsx)("span",{children:"Maximum 2 bags per passenger (additional bags $5 each)"})]}),(0,r.jsxs)("li",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-orange-600 mr-2",children:"•"}),(0,r.jsx)("span",{children:"Cancellations allowed up to 2 hours before departure"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,r.jsxs)("button",{onClick:()=>{if(!j||!d)return;let e=new Date(d.date),s=new Date(e.getTime()+108e5),t="https://calendar.google.com/calendar/render?action=TEMPLATE&text=SKOOT Shuttle to Charlotte Airport&dates=".concat(e.toISOString().replace(/[-:]/g,"").split(".")[0],"Z/").concat(s.toISOString().replace(/[-:]/g,"").split(".")[0],"Z&details=Booking ID: ").concat(n,"%0APassengers: ").concat(d.passengers,"%0ACustomer: ").concat(null==m?void 0:m.firstName," ").concat(null==m?void 0:m.lastName,"&location=Columbia, SC to Charlotte Douglas Airport");window.open(t,"_blank")},className:"flex flex-col sm:flex-row items-center justify-center space-y-1 sm:space-y-0 sm:space-x-2 bg-blue-600 text-white px-3 py-3 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[(0,r.jsx)(W.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:"Add to Calendar"})]}),(0,r.jsxs)("button",{onClick:()=>{window.print()},className:"flex flex-col sm:flex-row items-center justify-center space-y-1 sm:space-y-0 sm:space-x-2 bg-gray-600 text-white px-3 py-3 rounded-lg hover:bg-gray-700 transition-colors text-sm",children:[(0,r.jsx)($.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:"Receipt"})]}),(0,r.jsxs)("button",{onClick:u,className:"flex flex-col sm:flex-row items-center justify-center space-y-1 sm:space-y-0 sm:space-x-2 bg-orange-600 text-white px-3 py-3 rounded-lg hover:bg-orange-700 transition-colors text-sm",children:[(0,r.jsx)(J.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:"Book Again"})]}),(0,r.jsxs)(Q.default,{href:"/contact",className:"flex flex-col sm:flex-row items-center justify-center space-y-1 sm:space-y-0 sm:space-x-2 bg-gray-100 text-gray-700 px-3 py-3 rounded-lg hover:bg-gray-200 transition-colors text-center text-sm",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:"Support"})]})]}),!p&&(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-green-900 mb-2",children:"Create an Account"}),(0,r.jsx)("p",{className:"text-sm text-green-700 mb-4",children:"Save your information for faster future bookings and access to your booking history."}),(0,r.jsxs)(Q.default,{href:"/auth/signup",className:"inline-flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Create Free Account"})]})]})]})}var ee=t(8906);function es(e){var s,t;let{isVisible:a,stage:n,message:i}=e,[o,d]=(0,l.useState)(0),[m,x]=(0,l.useState)(0),u=[{id:"processing",label:"Processing request...",icon:Y.Z},{id:"payment",label:"Securing payment...",icon:c.Z},{id:"booking",label:"Creating booking...",icon:ee.Z},{id:"confirmation",label:"Confirming details...",icon:U.Z}];if((0,l.useEffect)(()=>{if(!a){d(0),x(0);return}x(u.findIndex(e=>e.id===n));let e=setInterval(()=>{d(e=>e>=100?100:e+10*Math.random())},300);return()=>clearInterval(e)},[a,n]),!a)return null;let h=(null===(s=u[m])||void 0===s?void 0:s.icon)||Y.Z;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-sm w-full text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(h,{className:"w-8 h-8 text-orange-600 animate-spin"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i||(null===(t=u[m])||void 0===t?void 0:t.label)||"Processing..."}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:(0,r.jsx)("div",{className:"bg-orange-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(Math.min(o,100),"%")}})}),(0,r.jsx)("div",{className:"flex justify-between mb-6",children:u.map((e,s)=>{let t=e.icon,a=s<m,l=s===m;return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center mb-1 ".concat(a?"bg-green-500 text-white":l?"bg-orange-500 text-white":"bg-gray-200 text-gray-400"),children:a?(0,r.jsx)(U.Z,{className:"w-3 h-3"}):(0,r.jsx)(t,{className:"w-3 h-3 ".concat(l?"animate-spin":"")})}),(0,r.jsx)("span",{className:"text-xs ".concat(l?"text-orange-600":a?"text-green-600":"text-gray-400"),children:e.id.charAt(0).toUpperCase()+e.id.slice(1)})]},e.id)})}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 bg-gray-50 rounded p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,r.jsx)(ee.Z,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"font-medium",children:"Secure Processing"})]}),(0,r.jsx)("p",{children:"Your payment information is encrypted and secure"})]})]})})}function et(){let e=(0,n.useRouter)(),[s,t]=(0,l.useState)("trip"),[a,h]=(0,l.useState)(!1),[g,f]=(0,l.useState)("processing"),[j,b]=(0,l.useState)(null),[y,N]=(0,l.useState)(null),[v,w]=(0,l.useState)(null),[k,S]=(0,l.useState)(null),[C,D]=(0,l.useState)(null),A=[{id:"trip",title:"Trip Details",icon:i.Z},{id:"customer",title:"Your Information",icon:o.Z},{id:"payment",title:"Payment",icon:c.Z},{id:"confirmation",title:"Confirmation",icon:d.Z}],P=A.findIndex(e=>e.id===s),I=async e=>{if(!y||!v){b("Missing booking information. Please start over.");return}h(!0),f("confirmation"),b(null);try{setTimeout(()=>{D(e.paymentIntentId),t("confirmation")},500)}catch(e){console.error("Booking error:",e),b(e instanceof Error?e.message:"An unexpected error occurred. Please try again.")}finally{h(!1)}},T=(0,l.useCallback)((e,s)=>{switch(e){case"trip":N(s),t("customer");break;case"customer":w(s),t("payment");break;case"payment":S(s),I(s)}},[]);return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("button",{onClick:()=>{let a=["trip","customer","payment","confirmation"],r=a.indexOf(s);r>0?t(a[r-1]):e.push("/")},className:"flex items-center text-gray-600 hover:text-orange-600 transition-colors font-medium",children:[(0,r.jsx)(m.Z,{className:"w-5 h-5 mr-2"}),"trip"===s?"Home":"Back"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:"S"})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"SKOOT"})]}),(0,r.jsxs)("a",{href:"tel:+1-803-SKOOT-SC",className:"flex items-center text-gray-600 hover:text-orange-600 transition-colors",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4 mr-1"}),(0,r.jsx)("span",{className:"hidden sm:inline text-sm",children:"Support"})]})]})})}),(0,r.jsx)("div",{className:"bg-white border-b",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:["trip"===s&&"Select Your Trip","customer"===s&&"Your Information","payment"===s&&"Secure Payment","confirmation"===s&&"Booking Confirmed"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["trip"===s&&"Choose your departure date, time, and passengers","customer"===s&&"Complete your contact details","payment"===s&&"Secure payment processing","confirmation"===s&&"Your trip is confirmed and ready"]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between overflow-x-auto pb-2",children:A.map((e,s)=>{let t=e.icon,a=s===P,l=s<P;return(0,r.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full border-2 ".concat(l?"bg-green-500 border-green-500 text-white":a?"bg-orange-500 border-orange-500 text-white":"bg-gray-200 border-gray-300 text-gray-500"),children:l?(0,r.jsx)(d.Z,{className:"w-4 h-4 sm:w-5 sm:h-5"}):(0,r.jsx)(t,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),(0,r.jsxs)("span",{className:"mt-2 text-xs sm:text-sm font-medium text-center whitespace-nowrap ".concat(a?"text-orange-600":l?"text-green-600":"text-gray-500"),children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:e.title}),(0,r.jsx)("span",{className:"sm:hidden",children:"Trip Details"===e.title?"Trip":"Your Information"===e.title?"Info":"Payment"===e.title?"Pay":"Done"})]})]}),s<A.length-1&&(0,r.jsx)("div",{className:"mx-2 sm:mx-4 md:mx-8 w-4 sm:w-8 md:w-16 h-0.5 ".concat(l?"bg-green-500":"bg-gray-300")})]},e.id)})})]})}),(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4 sm:py-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 sm:p-6",children:[(0,r.jsx)(es,{isVisible:a,stage:g,message:"booking"===g?"Creating your booking...":"confirmation"===g?"Finalizing details...":"Processing your request..."}),"trip"===s&&(0,r.jsx)(p,{onComplete:e=>T("trip",e)}),"customer"===s&&y&&(0,r.jsx)(Z,{tripDetails:y,onComplete:e=>T("customer",e)}),"payment"===s&&y&&v&&(0,r.jsx)(K,{tripDetails:y,customerDetails:v,onComplete:e=>T("payment",e)}),"confirmation"===s&&C&&(0,r.jsx)(X,{bookingId:C,tripDetails:y,customerDetails:v,onNewBooking:()=>{t("trip"),N(null),w(null),S(null),D(null)}}),j&&(0,r.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-red-400 mr-3 mt-0.5"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-red-800 mb-1",children:"Booking Error"}),(0,r.jsx)("p",{className:"text-sm text-red-700",children:j}),j.includes("contact support")&&(0,r.jsxs)("div",{className:"mt-3 flex space-x-3",children:[(0,r.jsx)("a",{href:"tel:+1-803-SKOOT-SC",className:"text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors",children:"Call Support"}),(0,r.jsx)("a",{href:"mailto:hello@skoot.bike",className:"text-sm bg-red-100 text-red-800 px-3 py-1 rounded hover:bg-red-200 transition-colors",children:"Email Us"})]})]}),(0,r.jsx)("button",{onClick:()=>b(null),className:"text-red-400 hover:text-red-600",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})})]})})]})})]})})}},8941:function(e,s,t){"use strict";t.d(s,{Z:function(){return d},a:function(){return o}});var a=t(7437),r=t(2265),l=t(605),n=t(9376);let i=(0,r.createContext)(void 0);function o(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){var s;let{children:t}=e,{data:o,status:c}=(0,l.useSession)(),d=(0,n.useRouter)(),[m,x]=(0,r.useState)(!0);(0,r.useEffect)(()=>{x("loading"===c)},[c]);let u={isAuthenticated:!!(null==o?void 0:o.user),isAdmin:!!(null==o?void 0:null===(s=o.user)||void 0===s?void 0:s.isAdmin),user:(null==o?void 0:o.user)||null,isLoading:m,requireAuth:e=>{if("loading"!==c&&!(null==o?void 0:o.user)){let s=window.location.pathname+window.location.search;d.push("/auth/signin?callbackUrl=".concat(encodeURIComponent(e||s)));return}},requireAdmin:e=>{if("loading"!==c){if(!(null==o?void 0:o.user)){let s=window.location.pathname+window.location.search;d.push("/auth/signin?callbackUrl=".concat(encodeURIComponent(e||s)));return}if(!o.user.isAdmin){d.push("/unauthorized");return}}}};return(0,a.jsx)(i.Provider,{value:u,children:t})}function d(e){let{children:s}=e;return(0,a.jsx)(l.SessionProvider,{children:(0,a.jsx)(c,{children:s})})}}},function(e){e.O(0,[605,648,64,971,117,744],function(){return e(e.s=3925)}),_N_E=e.O()}]);