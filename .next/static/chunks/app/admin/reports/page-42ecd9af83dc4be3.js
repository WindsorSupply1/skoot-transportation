(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{2199:function(e,s,t){Promise.resolve().then(t.bind(t,1013))},9763:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var r=t(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,s)=>{let t=(0,r.forwardRef)((t,l)=>{let{color:i="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:m="",children:x,...u}=t;return(0,r.createElement)("svg",{ref:l,...a,width:o,height:o,stroke:i,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(n(e)),m].join(" "),...u},[...s.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(x)?x:[x]])});return t.displayName="".concat(e),t}},2252:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2660:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1047:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},875:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},2135:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},5252:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2735:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},740:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},7168:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},525:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},5805:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},9376:function(e,s,t){"use strict";var r=t(5475);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}})},1013:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return f}});var r=t(7437),a=t(2265),n=t(605),l=t(9376),i=t(2252),o=t(2660),c=t(2735),d=t(7168),m=t(740),x=t(2135),u=t(875),h=t(5252),g=t(1047),p=t(525),y=t(5805);let v=(0,t(9763).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);function f(){let{data:e,status:s}=(0,n.useSession)(),t=(0,l.useRouter)(),[f,j]=(0,a.useState)(null),[N,b]=(0,a.useState)(!0),[w,k]=(0,a.useState)(null),[C,Z]=(0,a.useState)({from:new Date(Date.now()-2592e6).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),[R,S]=(0,a.useState)("overview"),[D,M]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if("loading"!==s){if(!(null==e?void 0:e.user)){t.push("/auth/signin");return}L()}},[e,s,t,C]);let L=async()=>{b(!0),k(null);try{let e=new URLSearchParams({from:C.from,to:C.to}),s=await fetch("/api/admin/reports/revenue?".concat(e));if(!s.ok)throw Error("Failed to fetch reports: ".concat(s.status));let t=await s.json();j(t)}catch(e){console.error("Failed to fetch reports:",e),k(e instanceof Error?e.message:"Failed to load reports")}finally{b(!1)}},F=async e=>{try{let s=new URLSearchParams({from:C.from,to:C.to,format:e,type:R}),t=await fetch("/api/admin/reports/export?".concat(s));if(!t.ok)throw Error("Failed to export report");let r=await t.blob(),a=window.URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download="skoot-report-".concat(C.from,"-to-").concat(C.to,".").concat(e),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(e){console.error("Failed to export report:",e),alert("Failed to export report")}},q=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),T=e=>"".concat(e.toFixed(1),"%"),U=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),E=(e,s)=>0===s?e>0?100:0:(e-s)/s*100;return N?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):w?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-8 max-w-md",children:[(0,r.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,r.jsx)(i.Z,{className:"h-8 w-8 mx-auto mb-2"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-center",children:"Error Loading Reports"})]}),(0,r.jsx)("p",{className:"text-gray-600 text-center mb-4",children:w}),(0,r.jsx)("button",{onClick:L,className:"w-full bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700",children:"Try Again"})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("button",{onClick:()=>t.push("/admin"),className:"flex items-center text-gray-500 hover:text-gray-700 mr-4",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Back"]}),(0,r.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:"SKOOT"}),(0,r.jsx)("div",{className:"ml-4 text-gray-500",children:"Revenue Reports & Analytics"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>F("csv"),className:"flex items-center px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),(0,r.jsxs)("button",{onClick:L,className:"flex items-center px-3 py-2 text-sm bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Refresh"]})]})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm mb-8 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Report Filters"}),(0,r.jsxs)("button",{onClick:()=>M(!D),className:"flex items-center text-gray-500 hover:text-gray-700",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),"Filters",D?(0,r.jsx)(x.Z,{className:"h-4 w-4 ml-1"}):(0,r.jsx)(u.Z,{className:"h-4 w-4 ml-1"})]})]}),D&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),(0,r.jsx)("input",{type:"date",value:C.from,onChange:e=>Z({...C,from:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),(0,r.jsx)("input",{type:"date",value:C.to,onChange:e=>Z({...C,to:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Type"}),(0,r.jsxs)("select",{value:R,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500",children:[(0,r.jsx)("option",{value:"overview",children:"Overview"}),(0,r.jsx)("option",{value:"routes",children:"Route Performance"}),(0,r.jsx)("option",{value:"customers",children:"Customer Analysis"}),(0,r.jsx)("option",{value:"trends",children:"Trends & Patterns"})]})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)("button",{onClick:()=>Z({from:new Date(Date.now()-2592e6).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),className:"w-full px-3 py-2 text-sm text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Reset to Last 30 Days"})})]})]}),f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"h-8 w-8 text-green-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Revenue"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:q(f.totalRevenue)}),(0,r.jsxs)("p",{className:"text-xs ".concat(E(f.totalRevenue,f.periodComparison.revenue)>=0?"text-green-600":"text-red-600"),children:[E(f.totalRevenue,f.periodComparison.revenue)>=0?"+":"",T(E(f.totalRevenue,f.periodComparison.revenue))," vs previous period"]})]})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(g.Z,{className:"h-8 w-8 text-blue-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Bookings"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalBookings}),(0,r.jsxs)("p",{className:"text-xs ".concat(E(f.totalBookings,f.periodComparison.bookings)>=0?"text-green-600":"text-red-600"),children:[E(f.totalBookings,f.periodComparison.bookings)>=0?"+":"",T(E(f.totalBookings,f.periodComparison.bookings))," vs previous period"]})]})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(p.Z,{className:"h-8 w-8 text-purple-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Avg Booking Value"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:q(f.averageBookingValue)}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"Per booking"})]})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(y.Z,{className:"h-8 w-8 text-indigo-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Unique Customers"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.uniqueCustomers}),(0,r.jsxs)("p",{className:"text-xs ".concat(E(f.uniqueCustomers,f.periodComparison.customers)>=0?"text-green-600":"text-red-600"),children:[E(f.uniqueCustomers,f.periodComparison.customers)>=0?"+":"",T(E(f.uniqueCustomers,f.periodComparison.customers))," vs previous period"]})]})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(v,{className:"h-8 w-8 text-orange-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Occupancy Rate"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:T(f.occupancyRate)}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"Average capacity utilization"})]})]})})]}),(0,r.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily Revenue Trend"}),(0,r.jsx)("div",{className:"space-y-3",children:f.dailyRevenue.slice(-14).map((e,s)=>{let t=Math.max(...f.dailyRevenue.map(e=>e.revenue)),a=t>0?e.revenue/t*100:0;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-16 text-sm text-gray-600",children:U(e.date)}),(0,r.jsx)("div",{className:"flex-1 mx-4",children:(0,r.jsx)("div",{className:"bg-gray-200 rounded-full h-4 relative",children:(0,r.jsx)("div",{className:"bg-orange-500 h-4 rounded-full transition-all duration-300",style:{width:"".concat(a,"%")}})})}),(0,r.jsx)("div",{className:"w-20 text-sm font-medium text-right",children:q(e.revenue)}),(0,r.jsxs)("div",{className:"w-16 text-sm text-gray-500 text-right",children:[e.bookings," bookings"]})]},e.date)})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Route Performance"}),(0,r.jsx)("div",{className:"space-y-4",children:f.routePerformance.map(e=>(0,r.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.routeName}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.bookings," bookings"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"font-bold text-gray-900",children:q(e.revenue)}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[T(e.occupancyRate)," occupied"]})]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(e.occupancyRate,"%")}})})]},e.routeId))})]})]}),(0,r.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Segments"}),(0,r.jsx)("div",{className:"space-y-4",children:f.customerSegments.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full mr-3 ".concat("VIP"===e.segment?"bg-purple-500":"Frequent"===e.segment?"bg-blue-500":"Regular"===e.segment?"bg-green-500":"bg-gray-500")}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.segment}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[e.count," customers"]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"font-bold text-gray-900",children:q(e.revenue)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:T(e.percentage)})]})]},e.segment))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Booking Distribution by Hour"}),(0,r.jsx)("div",{className:"space-y-3",children:f.hourlyDistribution.map(e=>{let s=Math.max(...f.hourlyDistribution.map(e=>e.bookings)),t=s>0?e.bookings/s*100:0;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"w-12 text-sm text-gray-600",children:[e.hour.toString().padStart(2,"0"),":00"]}),(0,r.jsx)("div",{className:"flex-1 mx-4",children:(0,r.jsx)("div",{className:"bg-gray-200 rounded-full h-3 relative",children:(0,r.jsx)("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-300",style:{width:"".concat(t,"%")}})})}),(0,r.jsx)("div",{className:"w-16 text-sm font-medium text-right",children:e.bookings}),(0,r.jsx)("div",{className:"w-20 text-sm text-gray-500 text-right",children:q(e.revenue)})]},e.hour)})})]})]})]})]})]})}}},function(e){e.O(0,[605,971,117,744],function(){return e(e.s=2199)}),_N_E=e.O()}]);